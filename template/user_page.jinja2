{% extends 'template.jinja2' %}
{% block title %}Dashboard{% endblock %}
{% block content %}
    <div class="col-lg-8 col-md-7 col-sm-5">
        <h4>Welcome, {{ user.name }}</h4>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-7">
        {% if "view_all_submitted_projects" in permissions %}
            <div class="col-sm-6">
                <div class="dropdown">
                    <button class="btn btn-primary dropdown-toggle" id="menu1" type="button" style="margin-right: 16px;" data-toggle="dropdown">Edit CoGS Markers
                    <span class="caret"></span></button>
                    <ul class="dropdown-menu" role="menu" aria-labelledby="menu1">
                        {% for rotation in rotations %}
                            <li role="presentation"><a role="menuitem" tabindex="-1" href="/groups/{{ rotation }}/edit_cogs">Rotation {{ rotation }}</a></li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
            <div class="visible-xs-block">
                <br>
            </div>

            <div class="col-sm-6">
                <div class="dropdown">
                    <button class="btn btn-primary dropdown-toggle" id="menu2" type="button" data-toggle="dropdown">Export Series
                    <span class="caret"></span></button>
                    <ul class="dropdown-menu" role="menu" aria-labelledby="menu2">
                        {% for year in series_years %}
                            <li role="presentation"><a role="menuitem" tabindex="-1" href="/groups/{{ year }}/export_group.xlsx">{{ year }}</a></li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        {% endif %}
    </div>
    <div class="clearfix"></div>

    {% if display_projects_link %}
        <a href="/projects">View projects</a>
    {% endif %}
    {% if "modify_permissions" in permissions %}
        <a href="/user_overview" class="pull-right">Edit Users</a>
        <br>
        <a href="/email_edit" class="pull-right">Edit Email Templates</a>
        <br>
    {% endif %}
    {% if show_create_rotation %}
        <a href="/create_rotation" class="pull-right">Create Rotation</a>
        <br>
    {% endif %}
    {% if show_finalise_choices %}
        <a href="/finalise_choices" class="pull-right">Finalise Student Choices</a>
    {% endif %}
    <div class="clearfix"></div>

    {% if "create_projects" in permissions %}
        <h4>My owned projects
        {% if can_edit %}
            <a href="/create_project" class="btn btn-primary btn-small">Create Project</a>
        {% endif %}
        </h4>
        {% include 'group_list_overview_inline.jinja2' %}
    {% endif %}
    {% if "review_other_projects" in permissions %}
        <h4>Projects you are the CoGS marker for</h4>
        {% with series_list = review_list %}
            {% include 'group_list_overview_inline.jinja2' %}
        {% endwith %}
    {% endif %}

    {% if "create_project_groups" in permissions %}
        {% for group in groups %}
            {% with create_button = "Modify rotation" %}
                {% include "group_form_inline.jinja2" %}
            {% endwith %}
        {% endfor %}
    {% endif %}
    <div class="clearfix"></div>


    {% if first_option or second_option %}
        <h4>My choices</h4>
    {% endif %}
    {% if first_option %}
        <h5>My first choice</h5>
        {% with project = first_option %}
            {% include "single_project_overview.jinja2" %}
        {% endwith %}
        <hr/>
    {% endif %}
    {% if second_option %}
        <h5>My second choice</h5>
        {% with project = second_option %}
            {% include "single_project_overview.jinja2" %}
        {% endwith %}
        <hr/>
    {% endif %}
    {% if third_option %}
        <h5>My third choice</h5>
        {% with project = third_option %}
            {% include "single_project_overview.jinja2" %}
        {% endwith %}
    {% endif %}
    {% if project_list %}
        {% if third_option %}
            <hr style="height:2px;border:none;color:#999;background-color:#ccc;" />
        {% endif %}
        <h4>My projects</h4>
        {% include 'group_overview_inline.jinja2' %}
    {% endif %}

{% endblock %}

{% block script %}
    {% if "create_project_groups" in permissions %}
        <script>
            no_datepickers = {{ deadlines | count }};
            {% for group in groups %}
                {% include "group_create_js.jinja2" %}
                $('button[name="add_group_{{ group.part }}"]').on('click', function(e) {
                    e.preventDefault();
                    $.ajax({
                        url: "/groups/{{ group.part }}/modify",
                        type: "post",
                        data: $("#edit_form_{{ group.part }}").serialize(),
                        success: function(response) {
                            window.location.replace(response);
                        }
                    });
                });
            {% endfor %}
        </script>
    {% endif %}
{% endblock %}